(function(k,_e){typeof exports=="object"&&typeof module<"u"?module.exports=_e(require("@threlte/core"),require("@threlte/extras")):typeof define=="function"&&define.amd?define(["@threlte/core","@threlte/extras"],_e):(k=typeof globalThis<"u"?globalThis:k||self,k["World-scene"]=_e(k.ThrelteCore,k.ThrelteExtras))})(this,function(k,_e){"use strict";const br="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(br);const Tr=1,Cr=2,Sr=16,kr=1,Ar=4,Pr=8,Rr=16,Dr=1,Mr=2,A=Symbol(),Lt=!1;var zt=Array.isArray,Fr=Array.prototype.indexOf,$t=Array.from,qt=Object.defineProperty,qe=Object.getOwnPropertyDescriptor,Ir=Object.prototype,Nr=Array.prototype,Or=Object.getPrototypeOf;function Lr(){var e,t,r=new Promise((n,a)=>{e=n,t=a});return{promise:r,resolve:e,reject:t}}const M=2,Bt=4,zr=8,Ce=16,Z=32,de=64,Ut=128,$=256,Be=512,R=1024,O=2048,X=4096,q=8192,ie=16384,Gt=32768,Ue=65536,Vt=1<<17,$r=1<<18,ut=1<<19,Wt=1<<20,ft=1<<21,ot=1<<22,le=1<<23,Ge=Symbol("$state"),qr=Symbol("legacy props"),vt=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function Br(){throw new Error("https://svelte.dev/e/await_outside_boundary")}function Ur(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function Gr(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function Vr(e){throw new Error("https://svelte.dev/e/props_invalid_value")}function Wr(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function Yr(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function jr(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}let Hr=!1;function Yt(e){return e===this.v}function Kr(e,t){return e!=e?t==t:e!==t||e!==null&&typeof e=="object"||typeof e=="function"}function jt(e){return!Kr(e,this.v)}let Zr=!1,Y=null;function Ve(e){Y=e}function Xr(e,t=!1,r){Y={p:Y,c:null,e:null,s:e,x:null,l:null}}function Jr(e){var t=Y,r=t.e;if(r!==null){t.e=null;for(var n of r)hn(n)}return Y=t.p,{}}function Ht(){return!0}const Qr=new WeakMap;function en(e){var t=y;if(t===null)return E.f|=le,e;if(t.f&Gt)ct(e,t);else{if(!(t.f&Ut))throw!t.parent&&e instanceof Error&&Kt(e),e;t.b.error(e)}}function ct(e,t){for(;t!==null;){if(t.f&Ut)try{t.b.error(e);return}catch(r){e=r}t=t.parent}throw e instanceof Error&&Kt(e),e}function Kt(e){const t=Qr.get(e);t&&(qt(e,"message",{value:t.message}),qt(e,"stack",{value:t.stack}))}function tn(){for(var e=y.b;e!==null&&!e.has_pending_snippet();)e=e.parent;return e===null&&Br(),e}function We(e){var t=M|O,r=E!==null&&E.f&M?E:null;return y===null||r!==null&&r.f&$?t|=$:y.f|=ut,{ctx:Y,deps:null,effects:null,equals:Yt,f:t,fn:e,reactions:null,rv:0,v:A,wv:0,parent:r??y,ac:null}}function rn(e,t){let r=y;r===null&&Ur();var n=r.b,a=void 0,i=Pe(A),s=null,f=!E;return pn(()=>{try{var l=e()}catch(d){l=Promise.reject(d)}var u=()=>l;a=s?.then(u,u)??Promise.resolve(l),s=a;var o=T,h=n.pending;f&&(n.update_pending_count(1),h||o.increment());const _=(d,c=void 0)=>{s=null,h||o.activate(),c?c!==vt&&(i.f|=le,je(i,c)):(i.f&le&&(i.f^=le),je(i,d)),f&&(n.update_pending_count(-1),h||o.decrement()),Qt()};if(a.then(_,d=>_(null,d||"unknown")),o)return()=>{queueMicrotask(()=>o.neuter())}}),new Promise(l=>{function u(o){function h(){o===a?l(i):u(a)}o.then(h,h)}u(a)})}function C(e){const t=We(e);return cr(t),t}function Zt(e){const t=We(e);return t.equals=jt,t}function Xt(e){var t=e.effects;if(t!==null){e.effects=null;for(var r=0;r<t.length;r+=1)fe(t[r])}}function nn(e){for(var t=e.parent;t!==null;){if(!(t.f&M))return t;t=t.parent}return null}function _t(e){var t,r=y;we(nn(e));try{Xt(e),t=mr(e)}finally{we(r)}return t}function Jt(e){var t=_t(e);if(e.equals(t)||(e.v=t,e.wv=hr()),!ge)if(he!==null)he.set(e,e.v);else{var r=(ne||e.f&$)&&e.deps!==null?X:R;I(e,r)}}function an(e,t,r){const n=We;if(t.length===0){r(e.map(n));return}var a=T,i=y,s=ln(),f=tn();Promise.all(t.map(l=>rn(l))).then(l=>{a?.activate(),s();try{r([...e.map(n),...l])}catch(u){i.f&ie||ct(u,i)}a?.deactivate(),Qt()}).catch(l=>{f.error(l)})}function ln(){var e=y,t=E,r=Y;return function(){we(e),re(t),Ve(r)}}function Qt(){we(null),re(null),Ve(null)}const Se=new Set;let T=null,he=null,er=new Set,Ye=[];function tr(){const e=Ye.shift();Ye.length>0&&queueMicrotask(tr),e()}let ke=[],dt=null,ht=!1;class Ae{current=new Map;#a=new Map;#i=new Set;#e=0;#f=null;#o=!1;#r=[];#l=[];#n=[];#t=[];#s=[];#v=[];#c=[];skipped_effects=new Set;process(t){ke=[];var r=null;if(Se.size>1){r=new Map,he=new Map;for(const[i,s]of this.current)r.set(i,{v:i.v,wv:i.wv}),i.v=s;for(const i of Se)if(i!==this)for(const[s,f]of i.#a)r.has(s)||(r.set(s,{v:s.v,wv:s.wv}),s.v=f)}for(const i of t)this.#d(i);if(this.#r.length===0&&this.#e===0){this.#_();var n=this.#n,a=this.#t;this.#n=[],this.#t=[],this.#s=[],T=null,rr(n),rr(a),T===null?T=this:Se.delete(this),this.#f?.resolve()}else this.#u(this.#n),this.#u(this.#t),this.#u(this.#s);if(r){for(const[i,{v:s,wv:f}]of r)i.wv<=f&&(i.v=s);he=null}for(const i of this.#r)Fe(i);for(const i of this.#l)Fe(i);this.#r=[],this.#l=[]}#d(t){t.f^=R;for(var r=t.first;r!==null;){var n=r.f,a=(n&(Z|de))!==0,i=a&&(n&R)!==0,s=i||(n&q)!==0||this.skipped_effects.has(r);if(!s&&r.fn!==null){if(a)r.f^=R;else if(!(n&R))if(n&Bt)this.#t.push(r);else if(n&ot){var f=r.b?.pending?this.#l:this.#r;f.push(r)}else Xe(r)&&(r.f&Ce&&this.#s.push(r),Fe(r));var l=r.first;if(l!==null){r=l;continue}}var u=r.parent;for(r=r.next;r===null&&u!==null;)r=u.next,u=u.parent}}#u(t){for(const r of t)(r.f&O?this.#v:this.#c).push(r),I(r,R);t.length=0}capture(t,r){this.#a.has(t)||this.#a.set(t,r),this.current.set(t,t.v)}activate(){T=this}deactivate(){T=null;for(const t of er)if(er.delete(t),t(),T!==null)break}neuter(){this.#o=!0}flush(){ke.length>0?sn():this.#_(),T===this&&(this.#e===0&&Se.delete(this),this.deactivate())}#_(){if(!this.#o)for(const t of this.#i)t();this.#i.clear()}increment(){this.#e+=1}decrement(){if(this.#e-=1,this.#e===0){for(const t of this.#v)I(t,O),se(t);for(const t of this.#c)I(t,X),se(t);this.#n=[],this.#t=[],this.flush()}else this.deactivate()}add_callback(t){this.#i.add(t)}settled(){return(this.#f??=Lr()).promise}static ensure(){if(T===null){const t=T=new Ae;Se.add(T),Ae.enqueue(()=>{T===t&&t.flush()})}return T}static enqueue(t){Ye.length===0&&queueMicrotask(tr),Ye.unshift(t)}}function sn(){var e=me;ht=!0;try{var t=0;for(or(!0);ke.length>0;){var r=Ae.ensure();if(t++>1e3){var n,a;un()}r.process(ke),ue.clear()}}finally{ht=!1,or(e),dt=null}}function un(){try{Gr()}catch(e){ct(e,dt)}}function rr(e){var t=e.length;if(t!==0){for(var r=0;r<t;){var n=e[r++];if(!(n.f&(ie|q))&&Xe(n)){var a=T?T.current.size:0;if(Fe(n),n.deps===null&&n.first===null&&n.nodes_start===null&&(n.teardown===null&&n.ac===null?sr(n):n.fn=null),T!==null&&T.current.size>a&&n.f&Wt)break}}for(;r<t;)se(e[r++])}}function se(e){for(var t=dt=e;t.parent!==null;){t=t.parent;var r=t.f;if(ht&&t===y&&r&Ce)return;if(r&(de|Z)){if(!(r&R))return;t.f^=R}}ke.push(t)}const ue=new Map;function Pe(e,t){var r={f:0,v:e,reactions:null,equals:Yt,rv:0,wv:0};return r}function J(e,t){const r=Pe(e);return cr(r),r}function fn(e,t=!1,r=!0){const n=Pe(e);return t||(n.equals=jt),n}function Q(e,t,r=!1){E!==null&&(!G||E.f&Vt)&&Ht()&&E.f&(M|Ce|ot|Vt)&&!j?.includes(e)&&jr();let n=r?pe(t):t;return je(e,n)}function je(e,t){if(!e.equals(t)){var r=e.v;ge?ue.set(e,t):ue.set(e,r),e.v=t;var n=Ae.ensure();n.capture(e,r),e.f&M&&(e.f&O&&_t(e),I(e,e.f&$?X:R)),e.wv=hr(),nr(e,O),y!==null&&y.f&R&&!(y.f&(Z|de))&&(z===null?yn([e]):z.push(e))}return t}function pt(e){Q(e,e.v+1)}function nr(e,t){var r=e.reactions;if(r!==null)for(var n=r.length,a=0;a<n;a++){var i=r[a],s=i.f,f=(s&O)===0;f&&I(i,t),s&M?nr(i,X):f&&se(i)}}function pe(e){if(typeof e!="object"||e===null||Ge in e)return e;const t=Or(e);if(t!==Ir&&t!==Nr)return e;var r=new Map,n=zt(e),a=J(0),i=oe,s=f=>{if(oe===i)return f();var l=E,u=oe;re(null),dr(i);var o=f();return re(l),dr(u),o};return n&&r.set("length",J(e.length)),new Proxy(e,{defineProperty(f,l,u){(!("value"in u)||u.configurable===!1||u.enumerable===!1||u.writable===!1)&&Wr();var o=r.get(l);return o===void 0?o=s(()=>{var h=J(u.value);return r.set(l,h),h}):Q(o,u.value,!0),!0},deleteProperty(f,l){var u=r.get(l);if(u===void 0){if(l in f){const o=s(()=>J(A));r.set(l,o),pt(a)}}else Q(u,A),pt(a);return!0},get(f,l,u){if(l===Ge)return e;var o=r.get(l),h=l in f;if(o===void 0&&(!h||qe(f,l)?.writable)&&(o=s(()=>{var d=pe(h?f[l]:A),c=J(d);return c}),r.set(l,o)),o!==void 0){var _=v(o);return _===A?void 0:_}return Reflect.get(f,l,u)},getOwnPropertyDescriptor(f,l){var u=Reflect.getOwnPropertyDescriptor(f,l);if(u&&"value"in u){var o=r.get(l);o&&(u.value=v(o))}else if(u===void 0){var h=r.get(l),_=h?.v;if(h!==void 0&&_!==A)return{enumerable:!0,configurable:!0,value:_,writable:!0}}return u},has(f,l){if(l===Ge)return!0;var u=r.get(l),o=u!==void 0&&u.v!==A||Reflect.has(f,l);if(u!==void 0||y!==null&&(!o||qe(f,l)?.writable)){u===void 0&&(u=s(()=>{var _=o?pe(f[l]):A,d=J(_);return d}),r.set(l,u));var h=v(u);if(h===A)return!1}return o},set(f,l,u,o){var h=r.get(l),_=l in f;if(n&&l==="length")for(var d=u;d<h.v;d+=1){var c=r.get(d+"");c!==void 0?Q(c,A):d in f&&(c=s(()=>J(A)),r.set(d+"",c))}if(h===void 0)(!_||qe(f,l)?.writable)&&(h=s(()=>J(void 0)),Q(h,pe(u)),r.set(l,h));else{_=h.v!==A;var p=s(()=>pe(u));Q(h,p)}var x=Reflect.getOwnPropertyDescriptor(f,l);if(x?.set&&x.set.call(o,u),!_){if(n&&typeof l=="string"){var b=r.get("length"),g=Number(l);Number.isInteger(g)&&g>=b.v&&Q(b,g+1)}pt(a)}return!0},ownKeys(f){v(a);var l=Reflect.ownKeys(f).filter(h=>{var _=r.get(h);return _===void 0||_.v!==A});for(var[u,o]of r)o.v!==A&&!(u in f)&&l.push(u);return l},setPrototypeOf(){Yr()}})}var on,vn,cn;function He(e=""){return document.createTextNode(e)}function Ke(e){return vn.call(e)}function Ze(e){return cn.call(e)}function ee(e,t){return Ke(e)}function te(e,t){{var r=Ke(e);return r instanceof Comment&&r.data===""?Ze(r):r}}function L(e,t=1,r=!1){let n=e;for(;t--;)n=Ze(n);return n}function _n(e){e.textContent=""}function mt(){return!1}function ar(e){var t=E,r=y;re(null),we(null);try{return e()}finally{re(t),we(r)}}function dn(e,t){var r=t.last;r===null?t.last=t.first=e:(r.next=e,e.prev=r,t.last=e)}function Re(e,t,r,n=!0){var a=y;a!==null&&a.f&q&&(e|=q);var i={ctx:Y,deps:null,nodes_start:null,nodes_end:null,f:e|O,first:null,fn:t,last:null,next:null,parent:a,b:a&&a.b,prev:null,teardown:null,transitions:null,wv:0,ac:null};if(r)try{Fe(i),i.f|=Gt}catch(l){throw fe(i),l}else t!==null&&se(i);var s=r&&i.deps===null&&i.first===null&&i.nodes_start===null&&i.teardown===null&&(i.f&ut)===0;if(!s&&n&&(a!==null&&dn(i,a),E!==null&&E.f&M&&!(e&de))){var f=E;(f.effects??=[]).push(i)}return i}function hn(e){return Re(Bt|Wt,e,!1)}function pn(e){return Re(ot|ut,e,!0)}function mn(e,t=[],r=[]){an(t,r,n=>{Re(zr,()=>e(...n.map(v)),!0)})}function gt(e,t=0){var r=Re(Ce|t,e,!0);return r}function De(e,t=!0){return Re(Z,e,!0,t)}function ir(e){var t=e.teardown;if(t!==null){const r=ge,n=E;vr(!0),re(null);try{t.call(null)}finally{vr(r),re(n)}}}function lr(e,t=!1){var r=e.first;for(e.first=e.last=null;r!==null;){const a=r.ac;a!==null&&ar(()=>{a.abort(vt)});var n=r.next;r.f&de?r.parent=null:fe(r,t),r=n}}function gn(e){for(var t=e.first;t!==null;){var r=t.next;t.f&Z||fe(t),t=r}}function fe(e,t=!0){var r=!1;(t||e.f&$r)&&e.nodes_start!==null&&e.nodes_end!==null&&(wn(e.nodes_start,e.nodes_end),r=!0),lr(e,t&&!r),Je(e,0),I(e,ie);var n=e.transitions;if(n!==null)for(const i of n)i.stop();ir(e);var a=e.parent;a!==null&&a.first!==null&&sr(e),e.next=e.prev=e.teardown=e.ctx=e.deps=e.fn=e.nodes_start=e.nodes_end=e.ac=null}function wn(e,t){for(;e!==null;){var r=e===t?null:Ze(e);e.remove(),e=r}}function sr(e){var t=e.parent,r=e.prev,n=e.next;r!==null&&(r.next=n),n!==null&&(n.prev=r),t!==null&&(t.first===e&&(t.first=n),t.last===e&&(t.last=r))}function wt(e,t){var r=[];yt(e,r,!0),ur(r,()=>{fe(e),t&&t()})}function ur(e,t){var r=e.length;if(r>0){var n=()=>--r||t();for(var a of e)a.out(n)}else t()}function yt(e,t,r){if(!(e.f&q)){if(e.f^=q,e.transitions!==null)for(const s of e.transitions)(s.is_global||r)&&t.push(s);for(var n=e.first;n!==null;){var a=n.next,i=(n.f&Ue)!==0||(n.f&Z)!==0;yt(n,t,i?r:!1),n=a}}}function xt(e){fr(e,!0)}function fr(e,t){if(e.f&q){e.f^=q,e.f&R||(I(e,O),se(e));for(var r=e.first;r!==null;){var n=r.next,a=(r.f&Ue)!==0||(r.f&Z)!==0;fr(r,a?t:!1),r=n}if(e.transitions!==null)for(const i of e.transitions)(i.is_global||t)&&i.in()}}let me=!1;function or(e){me=e}let ge=!1;function vr(e){ge=e}let E=null,G=!1;function re(e){E=e}let y=null;function we(e){y=e}let j=null;function cr(e){E!==null&&(j===null?j=[e]:j.push(e))}let D=null,F=0,z=null;function yn(e){z=e}let _r=1,Me=0,oe=Me;function dr(e){oe=e}let ne=!1;function hr(){return++_r}function Xe(e){var t=e.f;if(t&O)return!0;if(t&X){var r=e.deps,n=(t&$)!==0;if(r!==null){var a,i,s=(t&Be)!==0,f=n&&y!==null&&!ne,l=r.length;if((s||f)&&(y===null||!(y.f&ie))){var u=e,o=u.parent;for(a=0;a<l;a++)i=r[a],(s||!i?.reactions?.includes(u))&&(i.reactions??=[]).push(u);s&&(u.f^=Be),f&&o!==null&&!(o.f&$)&&(u.f^=$)}for(a=0;a<l;a++)if(i=r[a],Xe(i)&&Jt(i),i.wv>e.wv)return!0}(!n||y!==null&&!ne)&&I(e,R)}return!1}function pr(e,t,r=!0){var n=e.reactions;if(n!==null&&!j?.includes(e))for(var a=0;a<n.length;a++){var i=n[a];i.f&M?pr(i,t,!1):t===i&&(r?I(i,O):i.f&R&&I(i,X),se(i))}}function mr(e){var t=D,r=F,n=z,a=E,i=ne,s=j,f=Y,l=G,u=oe,o=e.f;D=null,F=0,z=null,ne=(o&$)!==0&&(G||!me||E===null),E=o&(Z|de)?null:e,j=null,Ve(e.ctx),G=!1,oe=++Me,e.ac!==null&&(ar(()=>{e.ac.abort(vt)}),e.ac=null);try{e.f|=ft;var h=e.fn,_=h(),d=e.deps;if(D!==null){var c;if(Je(e,F),d!==null&&F>0)for(d.length=F+D.length,c=0;c<D.length;c++)d[F+c]=D[c];else e.deps=d=D;if(!ne||o&M&&e.reactions!==null)for(c=F;c<d.length;c++)(d[c].reactions??=[]).push(e)}else d!==null&&F<d.length&&(Je(e,F),d.length=F);if(Ht()&&z!==null&&!G&&d!==null&&!(e.f&(M|X|O)))for(c=0;c<z.length;c++)pr(z[c],e);return a!==null&&a!==e&&(Me++,z!==null&&(n===null?n=z:n.push(...z))),e.f&le&&(e.f^=le),_}catch(p){return en(p)}finally{e.f^=ft,D=t,F=r,z=n,E=a,ne=i,j=s,Ve(f),G=l,oe=u}}function xn(e,t){let r=t.reactions;if(r!==null){var n=Fr.call(r,e);if(n!==-1){var a=r.length-1;a===0?r=t.reactions=null:(r[n]=r[a],r.pop())}}r===null&&t.f&M&&(D===null||!D.includes(t))&&(I(t,X),t.f&($|Be)||(t.f^=Be),Xt(t),Je(t,0))}function Je(e,t){var r=e.deps;if(r!==null)for(var n=t;n<r.length;n++)xn(e,r[n])}function Fe(e){var t=e.f;if(!(t&ie)){I(e,R);var r=y,n=me;y=e,me=!0;try{t&Ce?gn(e):lr(e),ir(e);var a=mr(e);e.teardown=typeof a=="function"?a:null,e.wv=_r;var i;Lt&&Zr&&e.f&O&&e.deps}finally{me=n,y=r}}}function v(e){var t=e.f,r=(t&M)!==0;if(E!==null&&!G){var n=y!==null&&(y.f&ie)!==0;if(!n&&!j?.includes(e)){var a=E.deps;if(E.f&ft)e.rv<Me&&(e.rv=Me,D===null&&a!==null&&a[F]===e?F++:D===null?D=[e]:(!ne||!D.includes(e))&&D.push(e));else{(E.deps??=[]).push(e);var i=e.reactions;i===null?e.reactions=[E]:i.includes(E)||i.push(E)}}}else if(r&&e.deps===null&&e.effects===null){var s=e,f=s.parent;f!==null&&!(f.f&$)&&(s.f^=$)}if(ge){if(ue.has(e))return ue.get(e);if(r){s=e;var l=s.v;return(!(s.f&R)&&s.reactions!==null||gr(s))&&(l=_t(s)),ue.set(s,l),l}}else if(r){if(s=e,he?.has(s))return he.get(s);Xe(s)&&Jt(s)}if(e.f&le)throw e.v;return e.v}function gr(e){if(e.v===A)return!0;if(e.deps===null)return!1;for(const t of e.deps)if(ue.has(t)||t.f&M&&gr(t))return!0;return!1}function En(e){var t=G;try{return G=!0,e()}finally{G=t}}const bn=-7169;function I(e,t){e.f=e.f&bn|t}function Tn(e){var t=document.createElement("template");return t.innerHTML=e.replaceAll("<!>","<!---->"),t.content}function Et(e,t){var r=y;r.nodes_start===null&&(r.nodes_start=e,r.nodes_end=t)}function Qe(e,t){var r=(t&Dr)!==0,n=(t&Mr)!==0,a,i=!e.startsWith("<!>");return()=>{a===void 0&&(a=Tn(i?e:"<!>"+e),r||(a=Ke(a)));var s=n||on?document.importNode(a,!0):a.cloneNode(!0);if(r){var f=Ke(s),l=s.lastChild;Et(f,l)}else Et(s,s);return s}}function Ie(){var e=document.createDocumentFragment(),t=document.createComment(""),r=He();return e.append(t,r),Et(t,r),e}function H(e,t){e!==null&&e.before(t)}function et(e,t){var r=t==null?"":typeof t=="object"?t+"":t;r!==(e.__t??=e.nodeValue)&&(e.__t=r,e.nodeValue=r+"")}function Ne(e,t,r=!1){var n=e,a=null,i=null,s=A,f=r?Ue:0,l=!1;const u=(d,c=!0)=>{l=!0,_(c,d)};var o=null;function h(){o!==null&&(o.lastChild.remove(),n.before(o),o=null);var d=s?a:i,c=s?i:a;d&&xt(d),c&&wt(c,()=>{s?i=null:a=null})}const _=(d,c)=>{if(s!==(s=d)){var p=mt(),x=n;if(p&&(o=document.createDocumentFragment(),o.append(x=He())),s?a??=c&&De(()=>c(x)):i??=c&&De(()=>c(x)),p){var b=T,g=s?a:i,w=s?i:a;g&&b.skipped_effects.delete(g),w&&b.skipped_effects.add(w),b.add_callback(h)}else h()}};gt(()=>{l=!1,t(u),l||_(null,null)},f)}function Cn(e,t){return t}function Sn(e,t,r){for(var n=e.items,a=[],i=t.length,s=0;s<i;s++)yt(t[s].e,a,!0);var f=i>0&&a.length===0&&r!==null;if(f){var l=r.parentNode;_n(l),l.append(r),n.clear(),V(e,t[0].prev,t[i-1].next)}ur(a,()=>{for(var u=0;u<i;u++){var o=t[u];f||(n.delete(o.k),V(e,o.prev,o.next)),fe(o.e,!f)}})}function kn(e,t,r,n,a,i=null){var s=e,f={flags:t,items:new Map,first:null},l=null,u=!1,o=new Map,h=Zt(()=>{var p=r();return zt(p)?p:p==null?[]:$t(p)}),_,d;function c(){An(d,_,f,o,s,a,t,n,r),i!==null&&(_.length===0?l?xt(l):l=De(()=>i(s)):l!==null&&wt(l,()=>{l=null}))}gt(()=>{d??=y,_=v(h);var p=_.length;if(!(u&&p===0)){u=p===0;var x,b,g,w;if(mt()){var P=new Set,B=T;for(b=0;b<p;b+=1){g=_[b],w=n(g,b);var K=f.items.get(w)??o.get(w);K?wr(K,g,b):(x=yr(null,f,null,null,g,w,b,a,t,r,!0),o.set(w,x)),P.add(w)}for(const[ye,U]of f.items)P.has(ye)||B.skipped_effects.add(U.e);B.add_callback(c)}else c();v(h)}})}function An(e,t,r,n,a,i,s,f,l){var u=t.length,o=r.items,h=r.first,_=h,d,c=null,p=[],x=[],b,g,w,P;for(P=0;P<u;P+=1){if(b=t[P],g=f(b,P),w=o.get(g),w===void 0){var B=n.get(g);if(B!==void 0){n.delete(g),o.set(g,B);var K=c?c.next:_;V(r,c,B),V(r,B,K),bt(B,K,a),c=B}else{var ye=_?_.e.nodes_start:a;c=yr(ye,r,c,c===null?r.first:c.next,b,g,P,i,s,l)}o.set(g,c),p=[],x=[],_=c.next;continue}if(wr(w,b,P),w.e.f&q&&xt(w.e),w!==_){if(d!==void 0&&d.has(w)){if(p.length<x.length){var U=x[0],N;c=U.prev;var ve=p[0],ce=p[p.length-1];for(N=0;N<p.length;N+=1)bt(p[N],U,a);for(N=0;N<x.length;N+=1)d.delete(x[N]);V(r,ve.prev,ce.next),V(r,c,ve),V(r,ce,U),_=U,c=ce,P-=1,p=[],x=[]}else d.delete(w),bt(w,_,a),V(r,w.prev,w.next),V(r,w,c===null?r.first:c.next),V(r,c,w),c=w;continue}for(p=[],x=[];_!==null&&_.k!==g;)_.e.f&q||(d??=new Set).add(_),x.push(_),_=_.next;if(_===null)continue;w=_}p.push(w),c=w,_=w.next}if(_!==null||d!==void 0){for(var xe=d===void 0?[]:$t(d);_!==null;)_.e.f&q||xe.push(_),_=_.next;var rt=xe.length;if(rt>0){var nt=null;Sn(r,xe,nt)}}e.first=r.first&&r.first.e,e.last=c&&c.e;for(var Tt of n.values())fe(Tt.e);n.clear()}function wr(e,t,r,n){je(e.v,t),e.i=r}function yr(e,t,r,n,a,i,s,f,l,u,o){var h=(l&Tr)!==0,_=(l&Sr)===0,d=h?_?fn(a,!1,!1):Pe(a):a,c=l&Cr?Pe(s):s,p={i:c,v:d,k:i,a:null,e:null,prev:r,next:n};try{if(e===null){var x=document.createDocumentFragment();x.append(e=He())}return p.e=De(()=>f(e,d,c,u),Hr),p.e.prev=r&&r.e,p.e.next=n&&n.e,r===null?o||(t.first=p):(r.next=p,r.e.next=p.e),n!==null&&(n.prev=p,n.e.prev=p.e),p}finally{}}function bt(e,t,r){for(var n=e.next?e.next.e.nodes_start:r,a=t?t.e.nodes_start:r,i=e.e.nodes_start;i!==null&&i!==n;){var s=Ze(i);a.before(i),i=s}}function V(e,t,r){t===null?e.first=r:(t.next=r,t.e.next=r&&r.e),r!==null&&(r.prev=t,r.e.prev=t&&t.e)}function W(e,t,r){var n=e,a,i,s=null,f=null;function l(){i&&(wt(i),i=null),s&&(s.lastChild.remove(),n.before(s),s=null),i=f,f=null}gt(()=>{if(a!==(a=t())){var u=mt();if(a){var o=n;u&&(s=document.createDocumentFragment(),s.append(o=He()),i&&T.skipped_effects.add(i)),f=De(()=>r(o,a))}u?T.add_callback(l):l()}},Ue)}let tt=!1;function Pn(e){var t=tt;try{return tt=!1,[e(),tt]}finally{tt=t}}function Oe(e,t,r,n){var a=(r&Pr)!==0,i=(r&Rr)!==0,s=n,f=!0,l=()=>(f&&(f=!1,s=i?En(n):n),s),u;if(a){var o=Ge in e||qr in e;u=qe(e,t)?.set??(o&&t in e?g=>e[t]=g:void 0)}var h,_=!1;a?[h,_]=Pn(()=>e[t]):h=e[t],h===void 0&&n!==void 0&&(h=l(),u&&(Vr(),u(h)));var d;if(d=()=>{var g=e[t];return g===void 0?l():(f=!0,g)},!(r&Ar))return d;if(u){var c=e.$$legacy;return function(g,w){return arguments.length>0?((!w||c||_)&&u(w?d():g),g):d()}}var p=!1,x=(r&kr?We:Zt)(()=>(p=!1,d()));a&&v(x);var b=y;return function(g,w){if(arguments.length>0){const P=w?v(x):a?pe(g):g;return Q(x,P),p=!0,s!==void 0&&(s=P),g}return ge&&p||b.f&ie?x.v:v(x)}}var Rn=Qe("<!> <!>",1),Dn=Qe("<!> <!>",1),Mn=Qe("<!> <!> <!> <!> <!> <!> <!>",1),Fn=Qe('<div class="world-scene-container svelte-uyqu5g"><!> <div class="scene-info svelte-uyqu5g"><div class="info-panel svelte-uyqu5g"><h3 class="text-lg font-semibold text-white mb-2"> </h3> <div class="text-sm text-gray-300 space-y-1"><p> </p> <p> </p> <p> </p></div></div></div></div>');function In(e,t){Xr(t,!0);let r=Oe(t,"cameraPosition",19,()=>({x:10,y:15,z:10})),n=Oe(t,"cameraTarget",19,()=>({x:0,y:0,z:0})),a=Oe(t,"showGrid",3,!0),i=Oe(t,"showAxes",3,!0),s=Oe(t,"enableControls",3,!0);const f={id:"default-world",name:"Demo World",entities:[{id:"ground-block",name:"Ground Block",type:"terrain",transform:{position:{x:0,y:-.5,z:0},rotation:{x:0,y:0,z:0,w:1},scale:{x:10,y:1,z:10}},geometry:{type:"box",dimensions:{x:10,y:1,z:10},material:{type:"basic",color:"#8B4513",roughness:.8}}},{id:"player-capsule",name:"Player Character",type:"player",transform:{position:{x:0,y:1,z:0},rotation:{x:0,y:0,z:0,w:1},scale:{x:1,y:1,z:1}},geometry:{type:"capsule",dimensions:{x:.5,y:2,z:.5},material:{type:"phong",color:"#4A90E2",roughness:.3,metalness:.1}}}],environment:{ambientLight:{color:"#404040",intensity:.4}},lighting:{directionalLights:[{color:"#ffffff",intensity:.8,position:{x:10,y:10,z:5},castShadow:!0}],pointLights:[]}};let l=C(()=>t.worldData||f);var u=Fn(),o=ee(u);k.Canvas(o,{gl:{antialias:!0,alpha:!0,shadowMap:!0,shadowMapType:1},shadows:!0,class:"w-full h-full",children:(K,ye)=>{var U=Mn(),N=te(U);{let S=C(()=>[r().x,r().y,r().z]),m=C(()=>[n().x,n().y,n().z]);W(N,()=>k.T.PerspectiveCamera,(ae,Le)=>{Le(ae,{fov:60,near:.1,far:1e3,get position(){return v(S)},get lookAt(){return v(m)}})})}var ve=L(N,2);{var ce=S=>{{let m=C(()=>[n().x,n().y,n().z]);_e.OrbitControls(S,{get target(){return v(m)},enablePan:!0,enableZoom:!0,enableRotate:!0,maxPolarAngle:Math.PI/2.1,minPolarAngle:.1,maxDistance:50,minDistance:2})}};Ne(ve,S=>{s()&&S(ce)})}var xe=L(ve,2);W(xe,()=>k.T.AmbientLight,(S,m)=>{m(S,{get color(){return v(l).environment.ambientLight.color},get intensity(){return v(l).environment.ambientLight.intensity}})});var rt=L(xe,2);{let S=C(()=>[v(l).lighting.directionalLights[0].position.x,v(l).lighting.directionalLights[0].position.y,v(l).lighting.directionalLights[0].position.z]);W(rt,()=>k.T.DirectionalLight,(m,ae)=>{ae(m,{get color(){return v(l).lighting.directionalLights[0].color},get intensity(){return v(l).lighting.directionalLights[0].intensity},get position(){return v(S)},get castShadow(){return v(l).lighting.directionalLights[0].castShadow},shadowMapWidth:2048,shadowMapHeight:2048,shadowCameraNear:.5,shadowCameraFar:50,shadowCameraLeft:-10,shadowCameraRight:10,shadowCameraTop:10,shadowCameraBottom:-10})})}var nt=L(rt,2);{var Tt=S=>{_e.Grid(S,{args:[20,20],cellSize:1,cellThickness:.5,cellColor:"#888888",sectionSize:5,sectionThickness:1,sectionColor:"#444444",fadeDistance:25,fadeStrength:1,followCamera:!1,infiniteGrid:!0})};Ne(nt,S=>{a()&&S(Tt)})}var xr=L(nt,2);{var Nn=S=>{var m=Ie(),ae=te(m);W(ae,()=>k.T.Axes,(Le,Ct)=>{Ct(Le,{args:[5]})}),H(S,m)};Ne(xr,S=>{i()&&S(Nn)})}var On=L(xr,2);kn(On,17,()=>v(l).entities,Cn,(S,m)=>{var ae=Ie(),Le=te(ae);{var Ct=Ee=>{var ze=Ie(),St=te(ze);{let kt=C(()=>[v(m).transform.position.x,v(m).transform.position.y,v(m).transform.position.z]),$e=C(()=>[v(m).transform.scale.x,v(m).transform.scale.y,v(m).transform.scale.z]),at=C(()=>v(m).type==="player"),At=C(()=>v(m).type==="terrain");W(St,()=>k.T.Mesh,(Pt,Rt)=>{Rt(Pt,{get position(){return v(kt)},get scale(){return v($e)},get castShadow(){return v(at)},get receiveShadow(){return v(At)},children:(Dt,Er)=>{var it=Rn(),lt=te(it);{let st=C(()=>[v(m).geometry.dimensions.x,v(m).geometry.dimensions.y,v(m).geometry.dimensions.z]);W(lt,()=>k.T.BoxGeometry,(be,Te)=>{Te(be,{get args(){return v(st)}})})}var Mt=L(lt,2);{let st=C(()=>v(m).geometry.material.roughness||.5),be=C(()=>v(m).geometry.material.metalness||0);W(Mt,()=>k.T.MeshStandardMaterial,(Te,Ft)=>{Ft(Te,{get color(){return v(m).geometry.material.color},get roughness(){return v(st)},get metalness(){return v(be)}})})}H(Dt,it)},$$slots:{default:!0}})})}H(Ee,ze)},Ln=Ee=>{var ze=Ie(),St=te(ze);{var kt=$e=>{var at=Ie(),At=te(at);{let Pt=C(()=>[v(m).transform.position.x,v(m).transform.position.y,v(m).transform.position.z]),Rt=C(()=>[v(m).transform.scale.x,v(m).transform.scale.y,v(m).transform.scale.z]),Dt=C(()=>v(m).type==="player"),Er=C(()=>v(m).type==="terrain");W(At,()=>k.T.Mesh,(it,lt)=>{lt(it,{get position(){return v(Pt)},get scale(){return v(Rt)},get castShadow(){return v(Dt)},get receiveShadow(){return v(Er)},children:(Mt,st)=>{var be=Dn(),Te=te(be);{let It=C(()=>[v(m).geometry.dimensions.x/2,v(m).geometry.dimensions.y,4,8]);W(Te,()=>k.T.CapsuleGeometry,(Nt,Ot)=>{Ot(Nt,{get args(){return v(It)}})})}var Ft=L(Te,2);{let It=C(()=>v(m).geometry.material.roughness||.5),Nt=C(()=>v(m).geometry.material.metalness||0);W(Ft,()=>k.T.MeshStandardMaterial,(Ot,zn)=>{zn(Ot,{get color(){return v(m).geometry.material.color},get roughness(){return v(It)},get metalness(){return v(Nt)}})})}H(Mt,be)},$$slots:{default:!0}})})}H($e,at)};Ne(St,$e=>{v(m).geometry.type==="capsule"&&$e(kt)},!0)}H(Ee,ze)};Ne(Le,Ee=>{v(m).geometry.type==="box"?Ee(Ct):Ee(Ln,!1)})}H(S,ae)}),H(K,U)},$$slots:{default:!0}});var h=L(o,2),_=ee(h),d=ee(_),c=ee(d),p=L(d,2),x=ee(p),b=ee(x),g=L(x,2),w=ee(g),P=L(g,2),B=ee(P);mn((K,ye,U,N,ve,ce)=>{et(c,v(l).name),et(b,`Entities: ${v(l).entities.length??""}`),et(w,`Camera: (${K??""}, ${ye??""}, ${U??""})`),et(B,`Target: (${N??""}, ${ve??""}, ${ce??""})`)},[()=>r().x.toFixed(1),()=>r().y.toFixed(1),()=>r().z.toFixed(1),()=>n().x.toFixed(1),()=>n().y.toFixed(1),()=>n().z.toFixed(1)]),H(e,u),Jr()}return In});
